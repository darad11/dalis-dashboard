<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Dalis Dashboard">
  <title>Dali's Dashboard</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="css/style.css">
</head>

<body>
  <!-- Quick Capture Button -->
  <button class="quick-capture-btn" id="quickCapture" title="Quick Add (Q)">+</button>

  <!-- Focus Mode Overlay -->
  <div class="focus-overlay" id="focusOverlay">
    <button class="focus-exit-btn" id="focusExit">‚úï Exit Focus Mode</button>
    <div class="focus-content">
      <div class="focus-timer">
        <svg class="pomo-ring" viewBox="0 0 100 100">
          <circle class="pomo-ring-bg" cx="50" cy="50" r="45" />
          <circle class="pomo-ring-progress focus-ring" cx="50" cy="50" r="45" />
        </svg>
        <div class="pomo-time" id="focusTime">25:00</div>
      </div>
      <div class="focus-task" id="focusTask">Focus on your work</div>
      <div class="focus-controls">
        <button class="btn" id="focusStart">‚ñ∂ Start</button>
        <button class="btn" id="focusReset">‚Ü∫ Reset</button>
      </div>
    </div>
  </div>

  <!-- Confetti Canvas -->
  <canvas id="confettiCanvas"></canvas>

  <!-- Notification Banner Container -->
  <div id="notificationContainer" class="notification-container"></div>

  <!-- Keyboard Shortcuts Modal -->
  <div class="shortcuts-modal" id="shortcutsModal">
    <div class="shortcuts-content glass-panel">
      <h3>‚å®Ô∏è Keyboard Shortcuts</h3>
      <div class="shortcuts-list">
        <div class="shortcut"><kbd>Space</kbd> Start/Pause Pomodoro</div>
        <div class="shortcut"><kbd>R</kbd> Reset Pomodoro</div>
        <div class="shortcut"><kbd>Q</kbd> Quick Capture</div>
        <div class="shortcut"><kbd>F</kbd> Focus Mode</div>
        <div class="shortcut"><kbd>D</kbd> Toggle Dark Mode</div>
        <div class="shortcut"><kbd>?</kbd> Show Shortcuts</div>
        <div class="shortcut"><kbd>Esc</kbd> Close Modal / Exit Focus</div>
      </div>
      <button class="btn" onclick="closeShortcuts()">Close</button>
    </div>
  </div>

  <!-- Custom Input Modal -->
  <div class="input-modal" id="inputModal">
    <div class="input-modal-content glass-panel">
      <h3 id="inputModalTitle">Enter text</h3>
      <input type="text" id="inputModalField" class="input-modal-field" placeholder="Type here...">
      <div class="input-modal-actions">
        <button class="btn input-modal-cancel" id="inputModalCancel">Cancel</button>
        <button class="btn input-modal-submit" id="inputModalSubmit">OK</button>
      </div>
    </div>
  </div>

  <!-- Custom Confirm Modal -->
  <div class="confirm-modal" id="confirmModal">
    <div class="confirm-modal-content glass-panel">
      <h3 id="confirmModalTitle">Confirm</h3>
      <p id="confirmModalMessage">Are you sure?</p>
      <div class="confirm-modal-actions">
        <button class="btn confirm-modal-cancel" id="confirmModalCancel">Cancel</button>
        <button class="btn confirm-modal-confirm" id="confirmModalConfirm">Confirm</button>
      </div>
    </div>
  </div>

  <div class="container" id="mainContainer">
    <header class="brand-header">
      <div class="brand-logo">d.</div>
      <div class="brand-text">
        <span class="brand-name">dali's</span>
        <span class="brand-tagline">dashboard</span>
      </div>
    </header>

    <div class="center-actions">
      <button id="btnToggleDark" class="btn icon-btn" onclick="toggleDark()" title="Toggle Dark Mode">üåô</button>
      <button class="btn icon-btn" onclick="enterFocusMode()" title="Focus Mode">üéØ</button>
      <button class="btn icon-btn" onclick="showShortcuts()" title="Keyboard Shortcuts">‚å®Ô∏è</button>
      <button id="syncStatus" class="btn icon-btn sync-status" onclick="showSyncDetails()" title="Sync Status">‚òÅÔ∏è</button>
      <button class="btn icon-btn" onclick="signOut()" title="Sign Out">üö™</button>
    </div>

    <!-- 1. POMODORO + STATS SIDE BY SIDE -->
    <!-- 1. POMODORO + STATS + SIDEBAR -->
    <div class="dashboard-main-layout">
      <div class="combined-glass-panel glass-panel" id="pomoStatsWrapper">
        <!-- Pomodoro Section -->
        <div class="pomodoro-section">
          <div class="pomo-header-row"
            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
            <h3 style="margin-bottom: 0;">üçÖ Pomodoro</h3>
            <button class="btn icon-btn" onclick="toggleStats()" id="btnToggleStats" title="Show Statistics"
              style="width: 32px; height: 32px; font-size: 1rem; margin-right: -8px;">üìä</button>
          </div>
          <div class="pomodoro-modes">
            <button class="pomo-mode-btn active" data-mode="work">Focus</button>
            <button class="pomo-mode-btn" data-mode="short">Break</button>
            <button class="pomo-mode-btn" data-mode="long">Long</button>
          </div>
          <div class="pomodoro-display">
            <svg class="pomo-ring" viewBox="0 0 100 100">
              <circle class="pomo-ring-bg" cx="50" cy="50" r="45" />
              <circle class="pomo-ring-progress" cx="50" cy="50" r="45" />
            </svg>
            <div class="pomo-time" id="pomoTime">25:00</div>
          </div>
          <div class="pomodoro-controls">
            <button class="btn pomo-btn" id="pomoStart">‚ñ∂ Start</button>
            <button class="btn pomo-btn" id="pomoReset">‚Ü∫ Reset</button>
          </div>
          <div class="pomo-sessions">
            <span id="pomoCount">0</span> sessions today
          </div>
          <!-- Ambient Sound -->
          <div class="ambient-controls">
            <label class="ambient-label">üîä</label>
            <select id="ambientSelect" class="ambient-select">
              <option value="none">None</option>
              <option value="white">White Noise</option>
              <option value="brown">Brown Noise</option>
              <option value="pink">Pink Noise</option>
              <option value="rain">Rain</option>
              <option value="forest">Forest</option>
              <option value="cafe">Caf√©</option>
            </select>
            <input type="range" id="ambientVolume" class="ambient-volume" min="0" max="100" value="30">
          </div>
          <button class="btn pip-btn" onclick="togglePiP()" title="Picture-in-Picture">
            <svg class="pip-icon" viewBox="0 0 24 20" width="16" height="14" fill="none" stroke="currentColor"
              stroke-width="2">
              <rect x="1" y="1" width="22" height="14" rx="2" />
              <rect x="12" y="8" width="10" height="6" rx="1" fill="currentColor" />
            </svg>
          </button>
        </div>

        <!-- Statistics Section (Collapsed by default) -->
        <div class="stats-section">
          <div style="margin-bottom: 32px; position: relative;">
            <h3 id="statsWeekTitle" style="margin: 0; text-align: center;">Week of December 30</h3>
            <div style="display: flex; gap: 8px; align-items: center; justify-content: center; margin-top: 16px;">
              <button class="btn" onclick="goToStatsToday()" style="margin-right: 8px;">Today</button>
              <button class="btn" onclick="changeStatsWeek(-1)">‚óÄÔ∏é</button>
              <button class="btn" onclick="changeStatsWeek(1)">‚ñ∂Ô∏é</button>
            </div>
          </div>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-value" id="statPomos">0</div>
              <div class="stat-label">Pomodoros</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="statTasks">0</div>
              <div class="stat-label">Tasks Done</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="statHabits">0%</div>
              <div class="stat-label">Habits</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="statStreak">0</div>
              <div class="stat-label">Day Streak</div>
            </div>
          </div>
        </div>
      </div>





      <!-- PiP Timer (Hidden) -->
      <div class="pip-timer" id="pipTimer">
        <div class="pip-header">
          <span class="pip-title"></span>
          <button class="pip-close" onclick="togglePiP()">√ó</button>
        </div>
        <div class="pip-time" id="pipTime">25:00</div>
        <div class="pip-controls">
          <button class="pip-control-btn" id="pipPlayPause" onclick="togglePomodoro()">‚ñ∂</button>
        </div>
      </div>

      <!-- Right Sidebar (Goals + Notes) -->
      <div class="dashboard-sidebar">
        <div class="sidebar-datetime" id="sidebarDateTime">--.--.---- - --:--</div>
        <div class="glass-panel goals-container">
          <div class="section-nav">
            <button class="btn nav-btn" onclick="changeGoalDate(-1)">‚óÄ</button>
            <h2 id="goalsTitle">üéØ Today's Goals</h2>
            <button class="btn nav-btn" onclick="changeGoalDate(1)">‚ñ∂</button>
          </div>
          <div class="goals-list" id="goalsList"></div>
          <button class="btn" onclick="addGoal()" style="margin-top:auto;">+ Add Goal</button>
        </div>
      </div>
    </div>

    <!-- 3. WEEKLY FOCUS (moved above quick notes) -->
    <h2>‚ö° Weekly Overview & Tasks</h2>
    <div class="glass-panel" style="padding: 20px 24px;">
      <div class="section-nav" style="margin-bottom: 0;">
        <h3 id="weekTitle" style="margin: 0;">Friday, January 3</h3>
        <div style="display: flex; gap: 8px; align-items: center; justify-content: flex-end; width: 100%;">
          <button class="btn" onclick="goToWeekToday()" style="margin-right: 8px;">Today</button>
          <button class="btn" onclick="changeWeek(-1)">‚óÄÔ∏é</button>
          <button class="btn" onclick="changeWeek(1)">‚ñ∂Ô∏é</button>
        </div>
      </div>
    </div>

    <div class="kanban-board week-kanban" id="weekKanban"></div>
    <h3 class="inspirational-quote" style="margin-top: 24px;">Your future is created by what you do today, not tomorrow
    </h3>

    <div class="divider"></div>

    <!-- Quick Notes (Full Width) -->
    <div class="glass-panel notes-container" style="margin-bottom: 24px;">
      <div class="section-nav">
        <h2 id="notesTitle">üìù Quick Notes</h2>
        <div style="display: flex; gap: 8px; align-items: center; justify-content: flex-end; width: 100%;">
          <button class="btn" onclick="goToNotesToday()" style="margin-right: 8px;">Today</button>
          <button class="btn" onclick="changeNotesDate(-1)">‚óÄÔ∏é</button>
          <button class="btn" onclick="changeNotesDate(1)">‚ñ∂Ô∏é</button>
        </div>
      </div>
      <textarea class="quick-notes" id="quickNotes" placeholder="Jot down thoughts, ideas, reminders..."></textarea>
    </div>





    <!-- 3. MINI LISTS (Goals 2026, Shopping, Chores) -->
    <div id="unifiedListsGrid" class="lists-grid"></div>

    <button class="btn glass-panel" onclick="createNewCustomList()"
      style="width: auto; min-width: 200px; border: 1px dashed rgba(255,255,255,0.3); justify-content: center; padding: 12px 24px; opacity: 0.8; margin: 48px auto 48px auto; display: flex;">
      + Create New List
    </button>

    <div class="divider"></div>

    <!-- 4. CALENDAR -->
    <div class="glass-panel">
      <div class="calendar-header">
        <div class="calendar-title-group" style="flex-direction: column;">
          <h2 id="title">User Calendar</h2>
        </div>
        <div style="display: flex; gap: 8px; align-items: center; justify-content: flex-end; width: 100%;">
          <button class="btn" onclick="goToToday()" style="margin-right: 8px;">Today</button>
          <button class="btn" id="prevMonth">‚óÄÔ∏é</button>
          <button class="btn" id="nextMonth">‚ñ∂Ô∏é</button>
        </div>
      </div>

      <div class="calendar-grid-header">
        <div>MO</div>
        <div>DI</div>
        <div>MI</div>
        <div>DO</div>
        <div>FR</div>
        <div>SA</div>
        <div>SO</div>
      </div>

      <div class="calendar-grid" id="calendar">
        <!-- JS generates Calendar -->
      </div>
    </div>

    <div class="divider"></div>

    <!-- 5. BACKLOG & IDEAS -->
    <h2>üìã Backlog & Ideas</h2>
    <div class="kanban-board long-kanban" id="longKanban"></div>

    <div class="divider"></div>

    <!-- 6. WEEKLY REVIEW -->
    <h2>üìù Weekly Review</h2>
    <div class="glass-panel">
      <div class="calendar-header">
        <div class="calendar-title-group" style="flex-direction: column;">
          <h3 id="reviewWeekTitle">Today, Week of December 30</h3>
        </div>
        <div style="display: flex; gap: 8px; align-items: center; justify-content: flex-end; width: 100%;">
          <button class="btn" onclick="goToReviewToday()" style="margin-right: 8px;">Today</button>
          <button class="btn" onclick="changeReviewWeek(-1)">‚óÄÔ∏é</button>
          <button class="btn" onclick="changeReviewWeek(1)">‚ñ∂Ô∏é</button>
        </div>
      </div>
      <textarea class="weekly-review" id="weeklyReview"
        placeholder="How was your week? What did you accomplish? What could be better?"></textarea>
    </div>

    <div class="divider"></div>

    <!-- 7. HABITS -->
    <h2>‚ú® Habits</h2>
    <h3 class="inspirational-quote">You don't look like your goals. You look like your habits. Effort never lies.</h3>
    <div class="glass-panel">
      <div class="calendar-header">
        <div class="calendar-title-group" style="flex-direction: column;">
          <h3 id="habitsWeekTitle">Today, Week of December 30</h3>
        </div>
        <div style="display: flex; gap: 8px; align-items: center; justify-content: flex-end; width: 100%;">
          <button class="btn" onclick="goToHabitsToday()" style="margin-right: 8px;">Today</button>
          <button class="btn" onclick="changeHabitsWeek(-1)">‚óÄÔ∏é</button>
          <button class="btn" onclick="changeHabitsWeek(1)">‚ñ∂Ô∏é</button>
        </div>
      </div>
      <div style="margin: 8px 0 4px 0;">
        <button class="btn" onclick="addHabit()">+ New Habit</button>
      </div>
      <div class="habits-grid" id="habits"></div>

      <!-- Habit Analytics (Collapsible) -->
      <div class="habit-analytics collapsed" id="habitAnalytics">
        <div style="display: flex; justify-content: center; margin-top: 8px; margin-bottom: 16px;">
          <button class="btn icon-btn" onclick="toggleAnalytics()" id="analyticsToggle" title="Toggle Analytics">
            üìä
          </button>
        </div>
        <div class="analytics-content" id="analyticsContent">
          <div class="habit-stats-grid">
            <div class="habit-stat-card">
              <div class="habit-stat-value" id="habitOverallRate">--%</div>
              <div class="habit-stat-label">This Week</div>
            </div>
            <div class="habit-stat-card">
              <div class="habit-stat-value" id="habitMonthlyRate">--%</div>
              <div class="habit-stat-label">Last 4 Weeks</div>
            </div>
            <div class="habit-stat-card">
              <div class="habit-stat-value" id="habitCurrentStreak">--</div>
              <div class="habit-stat-label">Current Streak</div>
            </div>
            <div class="habit-stat-card">
              <div class="habit-stat-value" id="habitBestStreak">--</div>
              <div class="habit-stat-label">Best Streak</div>
            </div>
          </div>

          <!-- Per-Habit Breakdown -->
          <div class="habit-breakdown" id="habitBreakdown"></div>

          <!-- Weekly Trend Chart -->
          <div class="habit-chart-container">
          </div>
        </div>
      </div>
    </div>


  </div>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="js/auth.js"></script>
  <script src="js/supabase.js"></script>
  <script src="js/app.js"></script>
</body>

</html>